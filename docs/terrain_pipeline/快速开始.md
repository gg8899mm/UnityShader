# 快速开始指南 - 5步30分钟上手

## 简介

这是一份**超浓缩版本**的快速指南，适合想快速了解系统的用户。完整细节请参考其他详细文档。

**预期耗时**：30分钟（仅用于理解流程）
**实际执行**：需要1-3小时（根据数据处理时间）

---

## 🎯 整体流程 (30秒版)

```
下载地理数据
    ↓
使用QGIS生成瓦片
    ↓
可选：转换为KTX2格式
    ↓
复制到Unity StreamingAssets
    ↓
配置TileStreamer并运行
```

---

## Step 1: 下载地理数据 (5分钟理论时间)

### 需要的文件

- **卫星影像**：42×48km范围的PNG或TIF
- **高程数据**：可选（DEM TIF文件）

### 快速获取

```
访问：https://www.tianditu.gov.cn/
操作：
1. 注册免费账户
2. "影像数据" → 框选您的矿区
3. 下载为 GeoTIFF 格式

或使用Google Earth Pro
```

---

## Step 2: 用QGIS生成瓦片 (90分钟核心时间)

### 安装QGIS

```
下载：https://qgis.org
版本：3.28 LTR（推荐）
```

### 核心步骤（顺序很重要！）

#### 2.1 打开QGIS并加载数据

```
1. QGIS → File → New Project
2. Project → Properties → CRS → EPSG:3857
3. Layer → Add Raster Layer → 选择你下载的satellite.tif
```

#### 2.2 重投影到Web Mercator

```
1. Processing → Toolbox
2. 搜索 "Warp (reproject)"
3. 参数：
   - Input layer: satellite.tif
   - Target CRS: EPSG:3857
   - Resampling: Bilinear
4. Run
```

**结果**：`satellite_3857.tif`

#### 2.3 裁剪到矿区范围

```
1. Processing → Toolbox
2. 搜索 "Clip raster by extent"
3. Input: satellite_3857.tif
4. Use canvas extent (在地图上框选你的范围)
5. Run
```

**结果**：`satellite_clip_3857.tif`

#### 2.4 生成基础瓦片 (z14-z18)

```
1. Processing → Toolbox
2. 搜索 "Generate XYZ tiles (Directory)"
3. 参数：
   Min zoom: 14
   Max zoom: 18
   Tile width: 512
   Tile height: 512
   Resampling: Bilinear
   ✓ Use XYZ tile numbering ← 必须勾选！
   Output: ./tiles_base/
4. Run (等待10-30分钟)
```

#### 2.5 为7个建筑群生成高精度瓦片 (z19-z20)

**对每个建筑群重复一次**：

```
对 building_1 到 building_7：

1. 在地图上框选建筑群周边1-3km范围
2. Processing → "Clip raster by extent"
   - Input: satellite_clip_3857.tif
   - Use canvas extent
   - Output: roi_building{N}_3857.tif
3. Processing → "Generate XYZ tiles"
   - Input: roi_building{N}_3857.tif
   - Min zoom: 19, Max zoom: 20
   - ✓ Use XYZ tile numbering
   - Output: ./tiles_roi_building{N}/
4. Run (每个5-15分钟)
```

**结果**：
```
tiles_base/
tiles_roi_building1/
tiles_roi_building2/
... (7个)
```

---

## Step 3: 转换为KTX2 (可选，省70%空间) [5分钟学习 + 15分钟执行]

### 为什么？

- 文件从 1600MB → 480MB
- 加载速度快30%

### 如何做？

```
1. 下载KTX-Software
   https://github.com/KhronosGroup/KTX-Software/releases

2. 解压到 C:\Tools\KTX-Software\

3. 在PowerShell中运行脚本：

   $source = "C:\Your\tiles_base"
   toktx --t2 --bcmp --genmipmap \
         --assign_oetf srgb \
         "$source\14\x\y.ktx2" \
         "$source\14\x\y.png"
   
   (对所有文件重复，或使用脚本自动化)
```

详细步骤 → 见 **PNG转KTX2.md**

---

## Step 4: 复制到Unity [5分钟]

### 目录结构

```
您的项目/
  Assets/
    StreamingAssets/
      ├── tiles_base/
      │   ├── 14/x/y.png (或 .ktx2)
      │   ├── 15/...
      │   └── ...
      ├── tiles_roi_building1/
      │   ├── 19/...
      │   └── 20/...
      ├── tiles_roi_building2/
      ...
      └── tiles_roi_building7/
```

### 复制命令 (PowerShell)

```powershell
Copy-Item "C:\Your\tiles_base" -Destination "Assets\StreamingAssets\tiles_base" -Recurse
Copy-Item "C:\Your\tiles_roi_building1" -Destination "Assets\StreamingAssets\tiles_roi_building1" -Recurse
# ... 重复复制 building2-7
```

---

## Step 5: Unity中运行 [5分钟配置]

### 5.1 导入脚本

```
复制到 Assets/Scripts/TileStreaming/:
  - ITileProvider.cs
  - LRUTileCache.cs
  - TileStreamer.cs
  - StreamingAssetsTileProvider.cs
  - StandardMaterialHook.cs
  - TileStreamerExample.cs
```

### 5.2 创建场景

```
1. 右键 → 3D Object → Quad
   - 命名：TerrainQuad
   - Scale: (100, 1, 100)

2. 右键 → 3D Object → Camera
   - 命名：MainCamera
   - Position: (50, 50, 50)

3. Assets → Create → Material
   - 命名：TerrainMaterial
   - Shader: Terrain/KTX2Tile (或 Standard)
```

### 5.3 配置TileStreamer

```
1. 右键 → Create Empty
   - 命名：TileStreamerManager

2. Add Component → TileStreamer
   - Min LOD: 14
   - Max LOD: 20
   - Cache Memory MB: 512
   - Max Concurrent Loads: 4

3. Add Component → TileStreamerExample
   - Terrain Material: (拖拽TerrainMaterial)
   - useKTX2: false (或true，如果你转了KTX2)

4. TerrainQuad → Mesh Renderer → Material
   - 拖拽 TerrainMaterial 到 Material字段
```

### 5.4 运行！

```
1. Press Play
2. 在Scene中移动相机
3. 应该看到瓦片加载和显示
4. Console中应无错误信息
5. 按 Space 查看缓存统计
```

---

## ✅ 验证清单

运行后检查：

```
□ 瓦片可见（显示在Quad上）
□ 移动相机时瓦片平滑变化
□ Console无红色错误
□ 按Space输出缓存统计
□ 帧率 > 30 FPS
```

---

## 🔥 常见卡点 (3分钟速查)

| 问题 | 原因 | 快速解决 |
|-----|-----|--------|
| 瓦片不显示 | 路径错误 | 检查StreamingAssets目录结构 |
| 错误：找不到文件 | 文件未复制 | 确认tiles_*文件夹已在StreamingAssets中 |
| 瓦片显示黑色 | 坐标错误 | 检查QGIS中勾选了"Use XYZ tile numbering" |
| 帧率很低 | 加载过多 | 减少Max Concurrent Loads或Cache Memory MB |
| 错误：EPSG:3857 | QGIS投影错 | Project → Properties → CRS重新设置 |

---

## 📚 需要详细信息？

看这些文档：

```
QGIS具体步骤？         → QGIS_工作流.md (§3-§6)
PNG转KTX2详细流程？     → PNG转KTX2.md (§2-§3)
坐标不对齐？            → 坐标对齐与场景设置.md (§5)
性能太低？              → 性能优化.md (§7)
Unity配置不对？         → Unity_TileStreamer集成.md (§3)
```

---

## 💡 建议

1. **第一遍**：按本快速指南完成一遍流程
2. **第二遍**：参考详细文档理解每一步的原理
3. **优化**：阅读性能优化.md调整参数

---

## 🎯 下一步

- ✅ 基础功能运行 → 阅读 **坐标对齐与场景设置.md**
- ✅ 想优化性能 → 阅读 **性能优化.md**
- ✅ 需要自定义 → 参考 **Unity_TileStreamer集成.md § 8**
- ✅ 遇到问题 → 查看各文档的"常见问题"部分

---

**祝您使用愉快！🚀**
